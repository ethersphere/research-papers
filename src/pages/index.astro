---
import cards from '../data/cards.json'
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';

import 'keen-slider/keen-slider.min.css';
---
<Layout title="Papers">
	<main class="">
		<section class="my-28">
      <div class="grid lg:grid-cols-12 lg:gap-x-[30px] mx-auto max-w-7xl px-5 lg:px-8">

        <h1 class="lg:col-span-8 font-bold text-[55px] leading-[62px] lg:text-[74px] lg:leading-[78px] text-[#111111]">Papers</h1>

        <div class="lg:col-span-6 text-[#626262] text-xl lg:text-[19px] leading-[24px] lg:leading-[28px] mt-[60px]">
          <p class="">Swarmâ€™s documentation includes a variety of papers from technical specifications to in-depth explorations of the network's architecture and functionalities, catering to a wide audience interested in decentralised technologies</p>
        </div>

        <div class="lg:col-span-6 text-[#626262] text-xl lg:text-[19px] leading-[24px] lg:leading-[28px] mt-[60px]">
          <p class="">As Swarm evolves, this section is regularly updated to include the latest information and insights, making it a valuable and dynamic resource for anyone looking to deepen their understanding of decentralised systems.</p>
        </div>
      </div>
    </section>

    <section class="bg-white pt-20 pb-14">
      <div class="grid lg:grid-cols-12 lg:gap-x-[30px] mx-auto max-w-7xl lg:space-y-8 px-5 lg:px-8">
        <h2 class="lg:col-span-6 text-[#111111] tracking-[-0.02em] text-[32px] leading-tight font-bold">Contents</h2>
      </div>
    </section>

    <!-- Responsive grid of cards (replaces Keen slider) -->
    <section class="w-full pb-40 overflow-hidden bg-white">
      <div class="px-5 mx-auto lg:px-8 max-w-7xl">
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
          {cards.map(({title, href, img, subtitle}) => (
            <Card title={title} href={href} img={img} subtitle={subtitle} />
          ))}
        </div>
      </div>
    </section>
	</main>
</Layout>


<script>
	import KeenSlider from "keen-slider";

  // Adapted navigation plugin for Keen Slider
  function navigationPlugin(sliderInstance: InstanceType<typeof KeenSlider>) {
    let arrowLeftElement: HTMLButtonElement | null = null;
    let arrowRightElement: HTMLButtonElement | null = null;
    let arrowsContainerElement: HTMLElement | null = null;

    // Creates a button element with specified classes
    function createArrowButton(className: string): HTMLButtonElement {
      const button = document.createElement("button");
      const classNames = className.split(" ");
      classNames.forEach((name) => button.classList.add(name));
      return button;
    }

    // Sets up the arrow markup (creates and appends arrows)
    function setupArrowMarkup(remove?: boolean) {
      arrowsContainerElement = document.getElementById("slider-arrows");
      if (!arrowsContainerElement) {
        console.error("Error: The #slider-arrows container was not found in the DOM.");
        return;
      }

      if (remove) {
        if (arrowLeftElement) arrowLeftElement.remove();
        if (arrowRightElement) arrowRightElement.remove();
        arrowLeftElement = null;
        arrowRightElement = null;
        return;
      }

      arrowLeftElement = createArrowButton("arrow arrow--left");
      arrowLeftElement.setAttribute("aria-label", "Previous slide");
      arrowLeftElement.addEventListener("click", () => sliderInstance.prev());

      arrowRightElement = createArrowButton("arrow arrow--right");
      arrowRightElement.setAttribute("aria-label", "Next slide");
      arrowRightElement.addEventListener("click", () => sliderInstance.next());

      arrowsContainerElement.appendChild(arrowLeftElement);
      arrowsContainerElement.appendChild(arrowRightElement);
    }

    // Updates arrow classes (e.g., disabled state) based on slider position
    function updateArrowStates() {
      if (!arrowLeftElement || !arrowRightElement || !sliderInstance.track || !sliderInstance.track.details) {
        // If arrows or track details are not available, do nothing.
        return;
      }

      const currentSlide = sliderInstance.track.details.rel;
      const minIdx = sliderInstance.track.details.minIdx;
      const maxIdx = sliderInstance.track.details.maxIdx;

      if (currentSlide === minIdx) {
        arrowLeftElement.classList.add("arrow--disabled");
        arrowLeftElement.disabled = true;
      } else {
        arrowLeftElement.classList.remove("arrow--disabled");
        arrowLeftElement.disabled = false;
      }

      if (currentSlide === maxIdx) {
        arrowRightElement.classList.add("arrow--disabled");
        arrowRightElement.disabled = true;
      } else {
        arrowRightElement.classList.remove("arrow--disabled");
        arrowRightElement.disabled = false;
      }
    }

    // Slider event handlers
    sliderInstance.on("created", () => {
      setupArrowMarkup();
      updateArrowStates();
    });

    sliderInstance.on("optionsChanged", () => {
      setupArrowMarkup(true); // Remove old arrows
      setupArrowMarkup();     // Create new ones based on new options
      updateArrowStates();
    });

    sliderInstance.on("slideChanged", () => {
      updateArrowStates();
    });

    sliderInstance.on("destroyed", () => {
      setupArrowMarkup(true); // Clean up arrows
    });
  }

  // KeenSlider configuration options
  const keenSliderOptions = {
    slides: {
      perView: 1.2,
      spacing: 32,
    },
    mode: "free-snap" as const, // Added 'as const' for stricter typing if beneficial
    breakpoints: {
      '(min-width: 640px)': { slides: { perView: 2.1, spacing: 32 } },
      '(min-width: 1024px)': { slides: { perView: 3.2, spacing: 32 } },
      '(min-width: 1280px)': { slides: { perView: 4, spacing: 32 } },
    },
  };

  // Initialize KeenSlider with the options and the navigation plugin
  // Using 'as any' for keenSliderOptions if complex type issues arise with plugins,
  // but attempting without it first for better type safety.
  const slider = new KeenSlider("#slider", keenSliderOptions as any, [navigationPlugin]);

</script>